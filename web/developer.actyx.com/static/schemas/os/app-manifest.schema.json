{
    "$schema": "http://json-schema.org/draft-06/schema#",
    "$id": "http://www.actyx.com/schemas/os/app-manifest.schema.json",
    "anyOf": [
        {
            "#": "Web App (WebView Runtime)",
            "allOf":
                [
                    { "$ref": "#/definitions/Composite/GeneralApp" },
                    { "$ref": "#/definitions/Composite/WebApp" }
                ]
        },
        {
            "#": "Docker App (Docker Runtime)",
            "allOf":
                [
                    { "$ref": "#/definitions/Composite/GeneralApp" },
                    { "$ref": "#/definitions/Composite/DockerApp" }
                ]
        }
    ],
    "definitions": {
        "Basic": {
            "Namespace": {
                "type": "string",
                "pattern": "^(\\d|\\w|-|_)+(\\.(\\d|\\w|-|_)+)*$"
            },
            "PathToDirectory": {
                "type": "string"
            },
            "PathToFile": {
                "type": "string"
            },
            "PathToJsonFile": {
                "type": "string",
                "pattern": "^.*\\.json$"
            },
            "PathToYamlFile": {
                "type": "string",
                "pattern": "^.*\\.(yml|yaml)$"
            },
            "PathToPngFile": {
                "type": "string",
                "pattern": "^.*\\.png$"
            },
            "PathToHtmlFile": {
                "type": "string",
                "pattern": "^.*\\.html$"
            },
            "NonEmptyString": {
                "type": "string",
                "minLength": 1
            },
            "SemanticVersion": {
                "type": "string",
                "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
            }
        },
        "Enum": {
            "ManifestVersion": {
                "type": "string",
                "enum": ["1.0"],
                "default": "1.0"
            }
        },
        "Composite": {
            "GeneralApp": {
                "type": "object",
                "required": [
                    "manifest-version",
                    "id",
                    "version",
                    "display-name"
                ],
                "properties": {
                    "manifest-version": { "$ref": "#/definitions/Enum/ManifestVersion" },
                    "id": { "$ref": "#/definitions/Basic/Namespace" },
                    "version": { "$ref": "#/definitions/Basic/SemanticVersion" },
                    "display-name": { "$ref": "#/definitions/Basic/NonEmptyString" },
                    "description": { "$ref": "#/definitions/Basic/NonEmptyString" },
                    "settings-schema": { "$ref": "#/definitions/Basic/PathToJsonFile" }
                }
            },
            "WebApp": {
                "type": "object",
                "required": [
                    "type",
                    "icon",
                    "dist",
                    "main"
                ],
                "properties": {
                    "type": { "type": "string", "const": "web" },
                    "icon": { "$ref": "#/definitions/Basic/PathToPngFile" },
                    "dist": { "$ref": "#/definitions/Basic/PathToDirectory" },
                    "main": { "$ref": "#/definitions/Basic/PathToHtmlFile" }
                }
            },
            "DockerApp": {
                "type": "object",
                "required": [
                    "type",
                    "docker-compose"
                ],
                "properties": {
                    "type": { "type": "string", "const": "docker" },
                    "docker-compose": {
                        "$ref": "#/definitions/Basic/PathToYamlFile",
                        "default": "docker-compose.yml"
                    }
                }
            }
        }
    }
}