---
title: Query Events
---

:::info This guide assumes Actyx is installed in the local development environment

If Actyx is not yet installed, [follow this instruction](/docs/how-to/local-development/install-actyx).

:::

Actyx functions primarily to [stream and store events](/docs/conceptual/event-streams),
which the application can use to publish events, query events, and subscribe to event streams.

In this guide we will use Actyx SDK, Actyx CLI, and Actyx Node Manager to query events.
Queries in Actyx is done with AQL, a query language specific to Actyx.
More about it can be found [here](/docs/how-to/structured-queries/query-events-with-aql) and [here](/docs/reference/aql).

## Using Actyx SDK (JS/TS)

:::info JS/TS knowledge

Follow Actyx SDK installation [instruction here](/docs/how-to/local-development/install-js-libs). The audience is assumed to be familiar with the development of application based on `JS/TS`, `NodeJS`, and `npm`.

:::

With Actyx SDK installed, import all required objects.
Before using Actyx SDK, prepare a [manifest](/docs/how-to/app-auth/authenticate-with-app-manifest).
Then, authenticate the manifest using the `Actyx.of` function

```typescript
import { Actyx, AqlEventMessage, Tag } from "@actyx/sdk";

const MANIFEST = {
  "appId": "com.example.app",
  "displayName": "Example App",
  "version": "1.0"
};

const main = async () => {
  const actyx = await Actyx.of(MANIFEST);
  // ... prepare query
  // ... run query
  // ... filter result
};
```

The method returns a promise that resolves into an `Actyx` object.
The object expose Actyx APIs, one of it is `.queryAql` which we will use for this guide.
We will run a simple AQL query to fetch events tagged with `sometag`.

```typescript
const main = async () => {
  // connect to actyx ...
  const aql = "FROM 'sometag'";
  // ... run query
  // ... filter result
};
```

Next, call the method with the query.

```typescript
const main = async () => {
  // connect to actyx ...
  // prepare query ... 
  const result = await actyx.queryAql(aql);
  // ... filter result
};
```

The returned promise resolves into `Array<AqlResponse>`.

`AqlResponse` is [union](https://www.typescriptlang.org/docs/handbook/2/everyday-types.html#union-types) comprised of several subtypes.
One of such subtype which is relevant to this guide is `AqlEventMessage`, a type that represents an event stored in Actyx.
Note that `AqlEventMessage` is imported at the beginning of this guide, which will be relevant to the next step: filtering the result.

```typescript
const main = async () => {
  // connect to actyx ...
  // prepare query ... 
  // run query ... 

  // Filter in `AqlEventMessage`
  const events = result
    .filter((item): item is AqlEventMessage => item.type === "event")

  // Further assume payload type
  // Note: do only when the application can ensure that `payload` is of type string.
  type AssumedPayloadType = { someProperty: string };
  const assumedPayloads = events 
    .map(item => item.payload as AssumedPayloadType)
};
```

To acquire the resulting events from the AQL query, use the `.filter` expression above.
This will yield `Array<AqlEventMessage>`.
The value of `AqlEventMessage.payload` maps to the event's value before being tagged (see event [publishing guide](/docs/how-to/basic-operations/publish)).

By default, the type of `AqlEventMessage.payload` is [`unknown`](https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes-func.html#other-important-typescript-types).
Further assumption of the type can be done using the `as` keyword shown above, or using a third-party runtime typing libraries such as [zod](https://zod.dev/) or [io-ts](https://github.com/gcanti/io-ts).

<details>
<summary><strong>Full code </strong>(click to expand)</summary>

```typescript
import { Actyx, AqlEventMessage, Tag } from "@actyx/sdk";

const main = async () => {
  // connect to actyx
  const actyx = await Actyx.of(MANIFEST);
  // prepare query
  const aql = "FROM 'sometag'";
  // run query
  const result = await actyx.queryAql(aql);

  // Filter in `AqlEventMessage`
  const events = result
    .filter((item): item is AqlEventMessage => item.type === "event")

  // Further assume payload type
  // Note: do only when the application can ensure that `payload` is of type string.
  type AssumedPayloadType = { someProperty: string };
  const assumedPayloads = events 
    .map(item => item.payload as AssumedPayloadType)
};
```

</details>

## Using Actyx CLI

:::info Actyx CLI is assumed to have been installed correctly

If that is not the case, follow the [instruction on this link](/docs/how-to/local-development/install-cli-node-manager#actyx-cli).

:::

Here is the command used to publish events:

```bash
USAGE:
    ax events query [FLAGS] [OPTIONS] <NODE> <query>
FLAGS:
    -h, --help       Prints help information
    -j, --json       Format output as JSON
    -V, --version    Prints version information
    -v
OPTIONS:
    -i, --identity <FILE>
            File from which the identity (private key) for
            authentication is read
ARGS:
    <NODE>     the IP address or <host>:<admin port> of the node
               to perform the operation on
    <query>    event API query (read from file if the argument
               starts with @)
```

The `<query>` parameter accepts AQL.
Below is an simple AQL that will fetch events tagged with `sometag`.
We will use this as an example.

```text
FROM 'sometag'
```

Assuming Actyx Node is running on `localhost`, to query events using the AQL above, run the command below:

```bash
$ ax events query localhost "FROM 'sometag'"
```

## Using Actyx Node Manager

:::info Actyx Node Manager is assumed to have been installed correctly

If that is not the case, follow the [instruction on this link](/docs/how-to/local-development/install-cli-node-manager#actyx-node-manager).

:::

1. Launch Node Manager, the application will show the _Nodes_ page. 
On the top of the page, put in the address of Actyx Node (`localhost`, the default, in this case) on the text field,
and then press "Add Node"

  ![connect to node](/images/how-to/basic-operations/node-manager-1-connect-to-node.png)

2. After the node is connected, navigate to the _Query_ page.

  ![navigate to query page](/images/how-to/basic-operations/node-manager-2-query-page.png)

3. In the query page you will see a text box where the AQL goes.
For this guide, we are going to use query events tagged with `sometag`.

  ![navigate to query page](/images/how-to/basic-operations/node-manager-3-aql.png)

4. Just below the AQL text field, select a node and then press the _Query_ button. The query will be issued to the selected node.

  ![navigate to query page](/images/how-to/basic-operations/node-manager-4-select-node.png)
  
5. The query result will be shown at the bottom of the page.

  ![navigate to query page](/images/how-to/basic-operations/node-manager-5-result.png)
