{
  "$schema": "http://json-schema.org/draft-06/schema#",
  "$id": "http://www.actyx.com/schemas/os/app-manifest.schema.json",
  "anyOf": [
    {
      "#": "Web App (WebView Runtime)",
      "allOf": [
        {
          "$ref": "#/definitions/Composite/GeneralApp"
        },
        {
          "$ref": "#/definitions/Composite/WebApp"
        }
      ]
    },
    {
      "#": "Docker App (Docker Runtime)",
      "allOf": [
        {
          "$ref": "#/definitions/Composite/GeneralApp"
        },
        {
          "$ref": "#/definitions/Composite/DockerApp"
        }
      ]
    }
  ],
  "definitions": {
    "Basic": {
      "Namespace": {
        "type": "string",
        "pattern": "^(\\d|\\w|-|_)+(\\.(\\d|\\w|-|_)+)*$"
      },
      "PathToDirectory": {
        "type": "string"
      },
      "PathToFile": {
        "type": "string"
      },
      "PathToJsonFile": {
        "type": "string",
        "pattern": "^.*\\.json$"
      },
      "PathToYamlFile": {
        "type": "string",
        "pattern": "^.*\\.(yml|yaml)$"
      },
      "PathToPngFile": {
        "type": "string",
        "pattern": "^.*\\.png$"
      },
      "PathToHtmlFile": {
        "type": "string",
        "pattern": "^.*\\.html$"
      },
      "NonEmptyString": {
        "type": "string",
        "minLength": 1
      },
      "SemanticVersion": {
        "type": "string",
        "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
      },
      "SettingsSchema": {
        "oneOf": [
          {
            "$ref": "#/definitions/Basic/PathToJsonFile"
          },
          {
            "$ref": "http://json-schema.org/draft-06/schema#"
          }
        ]
      }
    },
    "Enum": {
      "ManifestVersion": {
        "type": "string",
        "enum": [
          "2.0"
        ],
        "default": "2.0"
      }
    },
    "Composite": {
      "GeneralApp": {
        "type": "object",
        "required": [
          "manifestVersion",
          "id",
          "version",
          "displayName"
        ],
        "properties": {
          "manifestVersion": {
            "$ref": "#/definitions/Enum/ManifestVersion"
          },
          "id": {
            "$ref": "#/definitions/Basic/Namespace"
          },
          "version": {
            "$ref": "#/definitions/Basic/SemanticVersion"
          },
          "displayName": {
            "$ref": "#/definitions/Basic/NonEmptyString"
          },
          "description": {
            "$ref": "#/definitions/Basic/NonEmptyString"
          },
          "settingsSchema": {
            "$ref": "#/definitions/Basic/SettingsSchema"
          }
        }
      },
      "WebApp": {
        "type": "object",
        "required": [
          "type",
          "dist",
          "main"
        ],
        "properties": {
          "type": {
            "type": "string",
            "const": "web"
          },
          "icon": {
            "$ref": "#/definitions/Basic/PathToPngFile"
          },
          "dist": {
            "$ref": "#/definitions/Basic/PathToDirectory"
          },
          "main": {
            "$ref": "#/definitions/Basic/PathToHtmlFile"
          }
        }
      },
      "DockerApp": {
        "type": "object",
        "required": [
          "type",
          "dockerCompose"
        ],
        "properties": {
          "type": {
            "type": "string",
            "const": "docker"
          },
          "dockerCompose": {
            "type": "object",
            "properties": {
              "x86_64": {
                "$ref": "#/definitions/Basic/PathToYamlFile"
              },
              "aarch64": {
                "$ref": "#/definitions/Basic/PathToYamlFile"
              }
            }
          }
        }
      }
    }
  }
}
