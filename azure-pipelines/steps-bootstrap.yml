steps:
  - script: |
      BUILD_LINK=https://dev.azure.com/ax-ci/Cosmos/_build/results?buildId=$BUILD_BUILDID
      sudo apt-get update
      sudo apt-get install -y sshpass autossh curl
      mkdir ~/.ssh
      chmod 700 ~/.ssh
      ssh-keyscan -H ipfs.actyx.net >> ~/.ssh/known_hosts
      ssh-keyscan -H ipfs2.actyx.net >> ~/.ssh/known_hosts
      mkdir -p $HOME/bin
      export PATH=$HOME/bin:$PATH
      build/bin/install-vault.sh
      build/bin/forward-ipfs-gw.sh
      npm set //npm.pkg.github.com/:_authToken $GITHUB_PKG_PASS || true
    displayName: "Bootstrap helpers"
    env:
      # Map secrets to env vars
      AWS_ACCESS_KEY_ID: $(SECRET_AWS_ACCESS_KEY_ID)
      AWS_SECRET_ACCESS_KEY: $(SECRET_AWS_SECRET_ACCESS_KEY)
      GITHUB_PKG_PASS: $(SECRET_GITHUB_PKG_PASS)
    condition: contains(variables['BUILD_STRING'],variables['CURRENT_MODULE_BUILD_TAG'])
